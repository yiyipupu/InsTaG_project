# 一、运行步骤

### 1.进行环境配置

##### 1.conda 创建环境

```
conda create -n ai_server python=3.10 -y
conda activate ai_server
```

##### 2.运行以下命令

```
pip install flask
conda install -y requests
python -m pip install openai==2.14.0
```



### 2.联系组长打开两个服务器

- 用于InsTaG人脸训练合成
  - 使用vscode的远程连接插件连接服务器
  - 然后使用ssh root@140.210.142.177连接服务器
  - 密码为040421Pyb
- 用于语音克隆生成
  - 使用vscode的远程连接插件连接服务器
  - 然后使用ssh root@124.70.54.5连接服务器
  - 密码为Wxywchyhjwycwjm5



### 3.启动api_server

- InsTaG人脸部分
  - 使用以下命令启动docker容器，同时为TFG项目提供服务。
  
  - ```
    docker run --gpus all   -p 8000:8000   -e PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:128   -e LD_LIBRARY_PATH=/opt/conda/envs/instag/lib/python3.9/site-packages/torch/lib   -v /root/InsTaG:/workspace/InsTaG   instag:api-t4-fixed   python -m uvicorn api_server:app --host 0.0.0.0 --port 8000
    ```

- 语音克隆部分

  - 使用以下命令

  - ```
    docker start cosyvoice_api
    docker start sensevoice_api
    docker logs -f cosyvoice_api #查看日志输出
    ```



### 4.运行TFG项目代码

进入TFG/目录，运行python app.py。

**使用手机热点，不要用校园网，不要用校园网，不要用校园网！！！**

进入浏览器访问http://127.0.0.1:5000/

即可开始使用。

注意：若先进行模型训练，最好**等其训练结束**再进行后续的视频生成和人机对话过程。



### 5.使用app

注意：

1. 在**视频生成**页面中，模型目录地址填写 InsTaG/test2 或 InsTaG/test1 ，不要写其他路径。
2. 在**视频生成**页面中，参考音频地址填写 static/audios/prompt.wav ，不要写其他路径。 如果想测试自己的声音，可以录制一段“和所有的烦恼说拜拜，和所有的快乐说嗨嗨”的wav格式音频，替换掉prompt.wav文件即可。
3. 在**视频生成**页面中，GPU选择只能选择0
4. 在**视频生成**页面中，目标文字框内可以任意填写，但必须填写
5. 在**人机对话**页面中，**形象**处只能输入InsTaG/test2 或 InsTaG/test1，不要写其他路径
6. 在**人机对话**页面中，”声音克隆“处随意选择对音色其实无影响。但是如果修改过prompt.wav文件，即可听见不同的声音。



# 二、前端改进

### 1.美丽的前端界面&幽默的前端界面

我们制作了两套前端系统，一套以疯狂动物城为主题，一套注重于幽默风趣，可以看到将这一套命名为“抽象版”。其中抽象版中还能切换不同主题，适配白天使用与夜晚使用。



### 2.可选择不同的人脸

提供了两个人脸训练数据，可用于快速测试。



### 3.实时对话中可以选择AI风格

可以选择“毒舌”“温暖”“正常”三种AI风格，体会不同的乐趣。



